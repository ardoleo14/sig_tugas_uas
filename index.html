<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="stylesheet" href="css/leaflet.css">
<link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
<link rel="stylesheet" href="css/qgis2web.css">
<link rel="stylesheet" href="css/fontawesome-all.min.css">
<link rel="stylesheet" href="css/leaflet.photon.css">

<style>
html, body, #map {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}
.legend {
    background: white;
    padding: 8px;
    line-height: 18px;
    color: #333;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.8;
}
</style>

<title>WebGIS Kesesuaian Lahan Permukiman Kabupaten Sidoarjo</title>
</head>

<body>
<div id="map"></div>

<!-- LIBRARIES -->
<script src="js/leaflet.js"></script>
<script src="js/L.Control.Layers.Tree.min.js"></script>
<script src="js/leaflet-hash.js"></script>

<!-- DATA -->
<script src="data/Kesesuaian_Permukiman_Sidoarjo.js"></script>
<script src="data/Pendidikan_Sidoarjo_1.js"></script>
<script src="data/Permukiman_Sidoarjo_2.js"></script>
<script src="data/Sungai_Kecil_Sidoarjo_3.js"></script>
<script src="data/Rawa_Sidoarjo_4.js"></script>
<script src="data/Danau_Sidoarjo_5.js"></script>
<script src="data/Garis_Pantai_Sidoarjo_6.js"></script>
<script src="data/WADUK_Sidoarjo_7.js"></script>
<script src="data/Sungai_Besar_Sidoarjo_8.js"></script>

<script>
/* ================= MAP ================= */
var map = L.map('map',{zoomControl:false})
.fitBounds([
    [-7.620962942180029,112.5246924130729],
    [-7.165201187346662,112.96725200120454]
]);

new L.Hash(map);
L.control.zoom({position:'topleft'}).addTo(map);

/* ================= BASEMAP ================= */
map.createPane('paneOSM');
map.getPane('paneOSM').style.zIndex = 100;

var osm = L.tileLayer(
'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
{pane:'paneOSM', maxZoom:28}
).addTo(map);

/* ================= TITLE ================= */
var title = L.control({position:'topright'});
title.onAdd = function(){
    var div = L.DomUtil.create('div','info');
    div.innerHTML = '<h3>WebGIS Kesesuaian Lahan Permukiman<br>Kabupaten Sidoarjo</h3>';
    return div;
};
title.addTo(map);

/* ================= HELPER ================= */
function addLayer(json,pane,style,popup){
    map.createPane(pane);
    map.getPane(pane).style.zIndex = 401;
    return L.geoJson(json,{
        pane:pane,
        style:style,
        onEachFeature:popup,
        interactive:true
    }).addTo(map);
}

function popupAll(feature,layer){
    var html='<table>';
    for(var k in feature.properties){
        html+='<tr><td>'+k+'</td><td>'+feature.properties[k]+'</td></tr>';
    }
    html+='</table>';
    layer.bindPopup(html);
}

/* ================= STYLE ================= */
function styleKesesuaian(feature){
    var k = feature.properties.KELAS;
    var c='#ccc';
    if(k==='Sangat Sesuai') c='#1a9641';
    else if(k==='Sesuai') c='#a6d96a';
    else if(k==='Kurang Sesuai') c='#fdae61';
    else if(k==='Tidak Sesuai') c='#d7191c';
    return {color:'#333',weight:1,fillColor:c,fillOpacity:0.8};
}
function fill(c){return{color:'#333',weight:1,fillColor:c,fillOpacity:0.8};}

/* ================= LAYERS ================= */
var layerKesesuaian = addLayer(json_Kesesuaian_Permukiman_Sidoarjo,'paneKesesuaian',styleKesesuaian,popupAll);
var layerPendidikan = addLayer(json_Pendidikan_Sidoarjo_1,'panePendidikan',()=>fill('#c43c39'),popupAll);
var layerPermukiman = addLayer(json_Permukiman_Sidoarjo_2,'panePermukiman',()=>fill('#a47158'),popupAll);
var layerSungaiKecil = addLayer(json_Sungai_Kecil_Sidoarjo_3,'paneSK',()=>({color:'#85b66f'}),popupAll);
var layerRawa = addLayer(json_Rawa_Sidoarjo_4,'paneRawa',()=>fill('#ff9e17'),popupAll);
var layerDanau = addLayer(json_Danau_Sidoarjo_5,'paneDanau',()=>fill('#e77148'),popupAll);
var layerPantai = addLayer(json_Garis_Pantai_Sidoarjo_6,'panePantai',()=>({color:'#becf50'}),popupAll);
var layerWaduk = addLayer(json_WADUK_Sidoarjo_7,'paneWaduk',()=>fill('#729b6f'),popupAll);
var layerSungaiBesar = addLayer(json_Sungai_Besar_Sidoarjo_8,'paneSB',()=>({color:'#e5b636'}),popupAll);

/* ================= LEGEND ================= */
var legend=L.control({position:'bottomright'});
legend.onAdd=function(){
    var d=L.DomUtil.create('div','legend');
    d.innerHTML=
    '<b>Kesesuaian Lahan</b><br>'+
    '<i style="background:#1a9641"></i>Sangat Sesuai<br>'+
    '<i style="background:#a6d96a"></i>Sesuai<br>'+
    '<i style="background:#fdae61"></i>Kurang Sesuai<br>'+
    '<i style="background:#d7191c"></i>Tidak Sesuai';
    return d;
};
legend.addTo(map);

/* ================= LAYER CONTROL ================= */
L.control.layers.tree(null,[
    {label:'Kesesuaian Lahan Permukiman',layer:layerKesesuaian},
    {label:'Sungai Besar',layer:layerSungaiBesar},
    {label:'Waduk',layer:layerWaduk},
    {label:'Garis Pantai',layer:layerPantai},
    {label:'Danau',layer:layerDanau},
    {label:'Rawa',layer:layerRawa},
    {label:'Sungai Kecil',layer:layerSungaiKecil},
    {label:'Permukiman',layer:layerPermukiman},
    {label:'Pendidikan',layer:layerPendidikan},
    {label:'OSM',layer:osm}
],{collapsed:false}).addTo(map);
</script>
</body>
</html>
